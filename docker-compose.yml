version: '2'

services:
  pantry-api:
    image: klschaefer/pantry-api:latest
    pull_policy: always
    ports:
      - 4300:4300
    env_file:
      - stack.env
    environment:
      - DEFAULT_ADMIN_PASSWORD=${DEFAULT_ADMIN_PASSWORD}
      - PLAYWRIGHT_MCP_HOST=${PLAYWRIGHT_MCP_HOST:-playwright-mcp}
      - PLAYWRIGHT_MCP_PORT=${PLAYWRIGHT_MCP_PORT:-8930}
      - PLAYWRIGHT_NOVNC_HOST=${PLAYWRIGHT_NOVNC_HOST:-playwright-mcp}
      - PLAYWRIGHT_NOVNC_PORT=${PLAYWRIGHT_NOVNC_PORT:-6080}
      - TZ=${TZ:-UTC}
      - MQTT_BROKER=${MQTT_BROKER:-}
      - MQTT_PORT=${MQTT_PORT:-1883}
      - MQTT_USER=${MQTT_USER:-}
      - MQTT_PASSWORD=${MQTT_PASSWORD:-}
      - MQTT_TOPIC_PREFIX=${MQTT_TOPIC_PREFIX:-pantry}
    volumes:
      - pantry_data:/app/data
  pantry-ui:
    image: klschaefer/pantry-ui:latest
    pull_policy: always
    ports:
      - 4200:80
    environment:
      - API_BASEURL=${API_BASEURL}
      - SITE_TITLE=${SITE_TITLE}
      - TZ=${TZ:-UTC}
    # Removed host-dependent timezone volumes to fix Portainer deployment issues

  wyoming-whisper:
    image: rhasspy/wyoming-whisper
    ports:
      - 10300:10300
    volumes:
      - pantry_whisper:/data
    command: --model tiny --language en --initial-prompt "pantry kitchen food ingredients recipe shopping list add remove cook bake fridge freezer canned dry goods spices dairy meat vegetables fruit"

  playwright-mcp:
    build: ./playwright-mcp
    container_name: playwright-mcp
    ports:
      - 5900:5900 # VNC
      - 6080:6080 # noVNC web interface
      - 8930:8930 # Playwright MCP HTTP API (via socat forwarder)
    environment:
      - VNC_PASSWORD=playwright
      - SCREEN_WIDTH=1920
      - SCREEN_HEIGHT=1080
      - TZ=${TZ:-UTC}
    volumes:
      - pantry_playwright_data:/app/browser-data

volumes:
  pantry_data:
  pantry_whisper:
  pantry_playwright_data:


