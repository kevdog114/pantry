<div class="container">
    <div class="header-actions" style="display: flex; justify-content: space-between; align-items: center;">
        <h1>Shopping List</h1>
        <div>
            <span *ngIf="isSorting" style="font-size: 0.8em; margin-right: 8px; color: #666;">Sorting...</span>
            <button mat-icon-button [matMenuTriggerFor]="sortMenu" [disabled]="isSorting" aria-label="Sort options">
                <mat-icon>sort</mat-icon>
            </button>
            <mat-menu #sortMenu="matMenu">
                <button mat-menu-item (click)="sortAlphabetical()">
                    <mat-icon>sort_by_alpha</mat-icon>
                    <span>Alphabetical</span>
                </button>
                <button mat-menu-item (click)="sortSmart()">
                    <mat-icon>auto_awesome</mat-icon>
                    <span>Smart Sort (Gemini)</span>
                </button>
            </mat-menu>
        </div>
    </div>

    <div class="add-item-form">
        <mat-form-field appearance="outline" class="w-full">
            <mat-label>Add item</mat-label>
            <input matInput class="barcode-input" [(ngModel)]="newItemName" (keyup.enter)="addItem()"
                placeholder="Milk, Bread, etc.">
            <button mat-icon-button matSuffix (click)="addItem()">
                <mat-icon>add</mat-icon>
            </button>
        </mat-form-field>
    </div>

    <div *ngIf="isLoading" class="state-message">
        <p>Loading shopping list...</p>
    </div>

    <div *ngIf="error" class="error-message">
        <p>{{ error }}</p>
        <button mat-button (click)="loadList()">Retry</button>
    </div>

    <mat-list *ngIf="!isLoading && !error && shoppingList">
        <mat-list-item *ngFor="let item of shoppingList.items">
            <span matListItemTitle [class.checked]="item.checked">
                {{ item.name }}
                <mat-icon *ngIf="item.fromLogistics" class="logistics-icon ms-2"
                    style="font-size: 16px; width: 16px; height: 16px; vertical-align: middle; color: #673ab7;"
                    matTooltip="From Logistics Plan">smart_toy</mat-icon>
            </span>
            <span matListItemLine *ngIf="item.quantity !== 1 || item.unit">Quantity: {{ item.quantity }}{{ item.unit ? '
                ' + item.unit : '' }}</span>

            <button mat-icon-button matListItemMeta (click)="deleteItem(item)">
                <mat-icon>delete</mat-icon>
            </button>
            <mat-checkbox matListItemMeta [checked]="item.checked" (change)="toggleCheck(item)"></mat-checkbox>
        </mat-list-item>
    </mat-list>

    <div *ngIf="shoppingList?.items?.length === 0" class="empty-state">
        <p>Your shopping list is empty.</p>
    </div>

    <div class="actions" *ngIf="shoppingList && shoppingList.items.length > 0">
        <button mat-stroked-button color="warn" (click)="clearChecked()">Clear Checked</button>
    </div>
</div>