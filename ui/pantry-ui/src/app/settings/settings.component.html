<div class="settings-page">
    <div class="header">
        <h1>Settings</h1>
    </div>

    <mat-tab-group animationDuration="0ms" class="custom-tabs">
        <mat-tab label="Gemini AI">
            <div class="tab-content">
                <div class="settings-card">
                    <h2>Gemini Model Configuration</h2>
                    <p class="subtitle">Configure the AI models used for various features.</p>

                    <div *ngIf="loading" class="loading-state">
                        <div class="spinner"></div> Loading settings...
                    </div>

                    <div *ngIf="!loading" class="settings-form">
                        <div class="setting-item">
                            <div class="setting-info">
                                <h3>General Chat</h3>
                                <p>Model used for the main chat interface.</p>
                            </div>
                            <mat-form-field appearance="outline">
                                <mat-label>Select Model</mat-label>
                                <mat-select [(ngModel)]="selectedChatModel">
                                    <mat-option value="auto">Auto (Smart Routing)</mat-option>
                                    <mat-option *ngFor="let model of models" [value]="model.name">
                                        {{model.displayName}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <!-- Router Model (shown when Auto is selected) -->
                        <div class="setting-item sub-setting" *ngIf="selectedChatModel === 'auto'">
                            <div class="setting-info">
                                <h3>Router Model</h3>
                                <p>Fast model used to route requests and answer simple queries.</p>
                            </div>
                            <mat-form-field appearance="outline">
                                <mat-label>Select Router Model</mat-label>
                                <mat-select [(ngModel)]="selectedRouterModel">
                                    <mat-option *ngFor="let model of models" [value]="model.name">
                                        {{model.displayName}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <!-- Pro Model (shown when Auto is selected) -->
                        <div class="setting-item sub-setting" *ngIf="selectedChatModel === 'auto'">
                            <div class="setting-info">
                                <h3>Pro Model</h3>
                                <p>Powerful model used for complex requests.</p>
                            </div>
                            <mat-form-field appearance="outline">
                                <mat-label>Select Pro Model</mat-label>
                                <mat-select [(ngModel)]="selectedProModel">
                                    <mat-option *ngFor="let model of models" [value]="model.name">
                                        {{model.displayName}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h3>Vision & Recognition</h3>
                                <p>Model used for analyzing product images.</p>
                            </div>
                            <mat-form-field appearance="outline">
                                <mat-label>Select Model</mat-label>
                                <mat-select [(ngModel)]="selectedVisionModel">
                                    <mat-option *ngFor="let model of models" [value]="model.name">
                                        {{model.displayName}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h3>Quick Snack</h3>
                                <p>Model used for generating snack ideas.</p>
                            </div>
                            <mat-form-field appearance="outline">
                                <mat-label>Select Model</mat-label>
                                <mat-select [(ngModel)]="selectedQuickSnackModel">
                                    <mat-option *ngFor="let model of models" [value]="model.name">
                                        {{model.displayName}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h3>Image Generation</h3>
                                <p>Model used for generating product images (Imagen).</p>
                            </div>
                            <mat-form-field appearance="outline">
                                <mat-label>Select Model</mat-label>
                                <mat-select [(ngModel)]="selectedImageGenModel">
                                    <mat-option *ngFor="let model of models" [value]="model.name">
                                        {{model.displayName}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h3>Expiration Estimator</h3>
                                <p>Model used for guessing expiration dates.</p>
                            </div>
                            <mat-form-field appearance="outline">
                                <mat-label>Select Model</mat-label>
                                <mat-select [(ngModel)]="selectedExpirationModel">
                                    <mat-option *ngFor="let model of models" [value]="model.name">
                                        {{model.displayName}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h3>Debug Logging</h3>
                                <p>Log full API requests and responses to the server console (Docker logs).</p>
                            </div>
                            <mat-slide-toggle [(ngModel)]="debugLogging" color="warn">
                                Enabled
                            </mat-slide-toggle>
                        </div>

                        <div class="actions">
                            <button mat-flat-button color="primary" (click)="saveSettings()">
                                Save Changes
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </mat-tab>

        <mat-tab label="Display">
            <div class="tab-content">
                <div class="settings-card">
                    <h2>Display Settings</h2>
                    <p class="subtitle">Configure display options for different devices.</p>
                    <div class="settings-form">
                        <div class="setting-item">
                            <div class="setting-info">
                                <h3>Timezone</h3>
                                <p>Select the timezone for displaying time on the Kiosk.</p>
                            </div>
                            <mat-form-field appearance="outline">
                                <mat-label>Select Timezone</mat-label>
                                <mat-select [(ngModel)]="selectedTimezone">
                                    <mat-option *ngFor="let tz of availableTimezones" [value]="tz">
                                        {{tz}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>

                        <div class="setting-item">
                            <div class="setting-info">
                                <h3>Kiosk Mode</h3>
                                <p>Increases the size of the interface for small touch screens. (Zoom 1.25x / Font 1.5x)
                                </p>
                            </div>
                            <mat-slide-toggle [(ngModel)]="kioskMode" (change)="saveSettings()" color="primary">
                                Enabled
                            </mat-slide-toggle>
                        </div>
                    </div>
                </div>
            </div>
        </mat-tab>

        <mat-tab label="PBX">
            <div class="tab-content">
                <app-pbx-settings></app-pbx-settings>
            </div>
        </mat-tab>

        <mat-tab label="Meals">
            <div class="tab-content">
                <app-meal-settings></app-meal-settings>
            </div>
        </mat-tab>

        <mat-tab label="Weather">
            <div class="tab-content">
                <app-weather-settings></app-weather-settings>
            </div>
        </mat-tab>

        <mat-tab label="Hardware">
            <div class="tab-content">
                <app-hardware-settings></app-hardware-settings>
            </div>
        </mat-tab>
    </mat-tab-group>
</div>