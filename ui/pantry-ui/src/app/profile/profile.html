<div class="profile-container">
  <div class="profile-content">

    <!-- Change Password Section -->
    <mat-card class="profile-section">
      <mat-card-header>
        <mat-card-title>Change Password</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <form (ngSubmit)="changePassword()" class="password-form">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Old Password</mat-label>
            <input matInput type="password" name="oldPassword" [(ngModel)]="passwords.oldPassword">
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>New Password</mat-label>
            <input matInput type="password" name="newPassword" [(ngModel)]="passwords.newPassword">
          </mat-form-field>

          <p class="message" *ngIf="message">{{ message }}</p>
        </form>
      </mat-card-content>
      <mat-card-actions align="end">
        <button mat-flat-button color="primary" (click)="changePassword()">Change Password</button>
      </mat-card-actions>
    </mat-card>

    <!-- Personal Access Tokens Section -->
    <mat-card class="profile-section">
      <mat-card-header>
        <mat-card-title>Personal Access Tokens</mat-card-title>
      </mat-card-header>
      <mat-card-content>

        <div *ngIf="generatedToken" class="generated-token-box">
          <h3>New Token Generated</h3>
          <p>Please copy it now. You will not be able to see it again.</p>
          <div class="token-code">
            <code>{{ generatedToken }}</code>
          </div>
        </div>

        <form (ngSubmit)="createToken()" class="create-token-form">
          <mat-form-field appearance="outline" class="token-input">
            <mat-label>Token Name</mat-label>
            <input matInput type="text" name="newTokenName" [(ngModel)]="newTokenName">
          </mat-form-field>
          <button mat-stroked-button color="primary" type="submit" [disabled]="!newTokenName">Create Token</button>
        </form>

        <h3 class="subsection-title">Your Tokens</h3>
        <table mat-table [dataSource]="tokens" class="width-100" *ngIf="tokens.length > 0">
          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef> Name </th>
            <td mat-cell *matCellDef="let token"> {{token.name}} </td>
          </ng-container>

          <!-- Created At Column -->
          <ng-container matColumnDef="createdAt">
            <th mat-header-cell *matHeaderCellDef> Created At </th>
            <td mat-cell *matCellDef="let token"> {{token.createdAt | date}} </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef> </th>
            <td mat-cell *matCellDef="let token" class="action-cell">
              <button mat-icon-button color="warn" (click)="deleteToken(token.id)">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="['name', 'createdAt', 'actions']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['name', 'createdAt', 'actions'];"></tr>
        </table>
        <p *ngIf="tokens.length === 0" class="empty-state">No active tokens.</p>

      </mat-card-content>
    </mat-card>

    <!-- Push Notifications Section -->
    <mat-card class="profile-section">
      <mat-card-header>
        <mat-card-title>Push Notifications</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p>Enable push notifications to receive alerts on this device.</p>
        <div class="push-toggle-container">
          <mat-slide-toggle [(ngModel)]="notificationsEnabled" (change)="toggleNotifications()">
            Enable Notifications
          </mat-slide-toggle>
        </div>

        <div *ngIf="notificationsEnabled" class="push-actions" style="margin-top: 10px;">
          <button mat-stroked-button (click)="testNotification()">Test Notification</button>
        </div>

        <p *ngIf="pushMessage" class="message">{{ pushMessage }}</p>
      </mat-card-content>
    </mat-card>

    <!-- Kiosks Section -->
    <mat-card class="profile-section">
      <mat-card-header>
        <mat-card-title>Linked Kiosks</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <table mat-table [dataSource]="kiosks" class="width-100" *ngIf="kiosks.length > 0">
          <!-- Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef> Name </th>
            <td mat-cell *matCellDef="let kiosk"> {{kiosk.name}} </td>
          </ng-container>

          <!-- Added At Column -->
          <ng-container matColumnDef="createdAt">
            <th mat-header-cell *matHeaderCellDef> Added At </th>
            <td mat-cell *matCellDef="let kiosk"> {{kiosk.createdAt | date}} </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef> </th>
            <td mat-cell *matCellDef="let kiosk" class="action-cell">
              <button mat-button color="warn" (click)="removeKiosk(kiosk.id)">Remove</button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="['name', 'createdAt', 'actions']"></tr>
          <tr mat-row *matRowDef="let row; columns: ['name', 'createdAt', 'actions'];"></tr>
        </table>

        <p *ngIf="kiosks.length === 0" class="empty-state">No kiosks linked.</p>
      </mat-card-content>
    </mat-card>

  </div>
</div>