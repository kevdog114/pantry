<!-- Main Page Structure -->
<div class="header-section">
    <h1 class="page-title">Pantry Inventory</h1>

    <div class="actions-group">
        <a mat-stroked-button color="primary" [routerLink]="['/products', 'create']">
            <mat-icon>add</mat-icon> Create Product
        </a>
    </div>
</div>

<div class="toolbar-container">
    <!-- Search Bar -->
    <div class="search-container">
        <form (ngSubmit)="refreshList()" class="d-flex w-100 align-items-center">
            <mat-icon class="text-secondary ms-2">search</mat-icon>
            <input type="text" class="search-input" placeholder="Search products..." [(ngModel)]="searchTerm"
                name="searchTerm">
        </form>
    </div>

    <!-- Filter/Sort Group -->
    <div class="filter-group">

        <!-- Sort Dropdown (Simplified) -->
        <mat-form-field appearance="outline" subscriptSizing="dynamic" class="dense-form-field" style="width: 180px;">
            <mat-label>Sort By</mat-label>
            <mat-select [(value)]="selectedSortOption">
                <mat-option value="expire">Expiring Soon</mat-option>
                <mat-option value="alphabetical">Alphabetical</mat-option>
            </mat-select>
        </mat-form-field>

        <!-- Area Dropdown (Preserving existing UI even if logic was missing) -->
        <mat-form-field appearance="outline" subscriptSizing="dynamic" class="dense-form-field" style="width: 150px;">
            <mat-label>Area</mat-label>
            <mat-select [(ngModel)]="selectedLocationId" (selectionChange)="refreshList()">
                <mat-option [value]="undefined">-- All --</mat-option>
                <mat-option *ngFor="let loc of locations" [value]="loc.id">
                    {{loc.name}}
                </mat-option>
            </mat-select>
        </mat-form-field>

        <!-- View Toggle -->
        <div class="view-toggles">
            <mat-button-toggle-group name="displayMode" [(ngModel)]="DisplayMode" aria-label="View Mode">
                <mat-button-toggle value="grid" matTooltip="Grid View">
                    <mat-icon>grid_view</mat-icon>
                </mat-button-toggle>
                <mat-button-toggle value="list" matTooltip="List View">
                    <mat-icon>view_list</mat-icon>
                </mat-button-toggle>
            </mat-button-toggle-group>
        </div>
    </div>
</div>

<!-- Product Grid -->
<div class="product-grid" *ngIf="DisplayMode === 'grid'">
    <div class="product-card" *ngFor="let product of products" [routerLink]="['/products', product.id]">
        <div class="card-image-wrapper">
            <span *ngIf="product.isLeftover" class="leftover-badge">Leftover</span>
            <img *ngIf="GetFileDownloadUrl(product)" class="card-image" [src]="GetFileDownloadUrl(product)"
                alt="{{product.title}}">
            <div *ngIf="!GetFileDownloadUrl(product)" class="card-image-placeholder">
                <mat-icon>image_not_supported</mat-icon>
            </div>
        </div>
        <div class="card-content">
            <h3 class="card-title">{{product.title}}</h3>

            <div class="card-meta">
                <div class="expiry-info" *ngIf="product.minExpiration">
                    <mat-icon style="font-size: 16px; width: 16px; height: 16px;">event_busy</mat-icon>
                    <span>{{product.minExpiration | date:'mediumDate'}}</span>
                    <span *ngIf="product.quantityExpiringSoon"
                        class="text-muted ms-1">({{product.quantityExpiringSoon}})</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Product List -->
<div class="product-list-container" *ngIf="DisplayMode === 'list'">
    <a [routerLink]="['/products', product.id]" class="list-item" *ngFor="let product of products">
        <img *ngIf="GetFileDownloadUrl(product)" class="list-avatar" [src]="GetFileDownloadUrl(product)" alt="">
        <div *ngIf="!GetFileDownloadUrl(product)"
            class="list-avatar d-flex align-items-center justify-content-center bg-secondary-subtle text-secondary">
            <mat-icon style="font-size: 24px; width: 24px; height: 24px;">image_not_supported</mat-icon>
        </div>

        <div class="list-details">
            <div class="list-title">
                {{product.title}}
                <span *ngIf="product.isLeftover" class="badge bg-warning text-dark rounded-pill"
                    style="font-size: 0.7em;">Leftover</span>
            </div>
            <div class="list-meta">
                <span *ngIf="product.totalQuantity">{{product.totalQuantity}} in stock</span>
                <span *ngIf="product.minExpiration" class="text-danger d-flex align-items-center gap-1">
                    <mat-icon style="font-size: 16px; width: 16px; height: 16px;">event_busy</mat-icon>
                    Exp: {{product.minExpiration | date}}
                </span>
            </div>
        </div>

        <mat-icon class="text-secondary">chevron_right</mat-icon>
    </a>
</div>

<!-- Quick Snack FAB -->
<button mat-fab class="quick-snack-fab" color="tertiary" (click)="openQuickSnack()" matTooltip="Quick Snack">
    <mat-icon>lunch_dining</mat-icon>
</button>