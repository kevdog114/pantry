<div class="container mx-auto p-4 max-w-4xl">
    <h1 class="text-3xl font-bold mb-6 text-gray-800 dark:text-gray-100">Hardware Devices</h1>

    <div class="grid grid-cols-1 gap-6">
        <mat-card *ngFor="let kiosk of kiosks" class="mb-4 overflow-hidden rounded-xl shadow-lg dark:bg-zinc-800">
            <div
                class="flex items-center p-4 bg-gray-50 dark:bg-zinc-700/50 border-b border-gray-100 dark:border-zinc-700">
                <div class="bg-blue-100 p-2 rounded-full text-blue-600 flex items-center justify-center mr-4 h-10 w-10">
                    <mat-icon>desktop_windows</mat-icon>
                </div>
                <div class="flex-1">
                    <h3 class="text-xl font-medium m-0">{{ kiosk.name }}</h3>
                    <p class="text-sm text-gray-500 m-0">Last Active: {{ kiosk.lastActive | date:'short' }}</p>
                </div>
                <div class="flex items-center">
                    <button mat-stroked-button color="primary" class="mr-4" (click)="claimScanner(kiosk.id)"
                        matTooltip="Route scanner events to this device">
                        <mat-icon>qr_code_scanner</mat-icon>
                        Claim Scanner
                    </button>
                    <mat-slide-toggle [checked]="!!kiosk.hasKeyboardScanner" (change)="toggleScanner(kiosk)"
                        color="primary">
                        Keyboard Scanner
                    </mat-slide-toggle>
                </div>
            </div>
            <mat-card-content class="p-0">
                <mat-list role="list" class="divide-y divide-gray-100 dark:divide-zinc-700">
                    <div *ngIf="kiosk.devices && kiosk.devices.length > 0; else noDevices">
                        <mat-list-item role="listitem" *ngFor="let device of kiosk.devices"
                            class="hover:bg-gray-50 dark:hover:bg-zinc-700/30 transition-colors">
                            <mat-icon matListItemIcon class="text-gray-400">
                                {{ device.type === 'PRINTER' ? 'print' : (device.type === 'RECEIPT_PRINTER' ? 'receipt'
                                : (device.type === 'SCALE' ? 'linear_scale' : 'usb')) }}
                            </mat-icon>
                            <div matListItemTitle class="font-medium">{{ device.name }}</div>
                            <div matListItemLine class="flex items-center gap-2">
                                <span>Status:</span>
                                <span [class.text-green-600]="device.status === 'ONLINE' || device.status === 'READY'"
                                    [class.text-red-500]="device.status !== 'ONLINE' && device.status !== 'READY'"
                                    class="font-bold text-xs uppercase tracking-wide bg-opacity-10 px-2 py-0.5 rounded-full"
                                    [ngClass]="(device.status === 'ONLINE' || device.status === 'READY') ? 'bg-green-100' : 'bg-red-100'">
                                    {{ device.status }}
                                </span>
                            </div>
                            <div matListItemLine class="text-xs text-gray-400">Last Seen: {{ device.lastSeen |
                                date:'short' }}</div>
                            <div matListItemLine class="mt-1 flex flex-wrap gap-2"
                                *ngIf="device.type === 'PRINTER' && getDeviceDetails(device) as details">
                                <span
                                    class="bg-blue-50 dark:bg-zinc-700/50 text-blue-700 dark:text-blue-300 text-xs px-2 py-0.5 rounded border border-blue-100 dark:border-blue-900"
                                    *ngIf="details.media">
                                    {{ details.media }}
                                </span>
                                <span
                                    class="bg-gray-50 dark:bg-zinc-700 text-gray-600 dark:text-gray-400 text-xs px-2 py-0.5 rounded border border-gray-200 dark:border-gray-600"
                                    *ngIf="details.config?.model">
                                    {{ details.config.model }}
                                </span>
                            </div>
                            <div matListItemMeta>
                                <div
                                    *ngIf="(device.type === 'PRINTER' || device.type === 'RECEIPT_PRINTER') && (device.status === 'ONLINE' || device.status === 'READY')">
                                    <button mat-icon-button color="primary" (click)="printTestLabel(device, kiosk.id)"
                                        matTooltip="Print Test Label">
                                        <mat-icon>print</mat-icon>
                                    </button>
                                    <button mat-icon-button (click)="configureDevice(device, kiosk.id)"
                                        matTooltip="Configuration">
                                        <mat-icon>settings</mat-icon>
                                    </button>
                                </div>
                                <div *ngIf="device.type === 'SCALE' && (device.status === 'ONLINE')">
                                    <button mat-flat-button color="primary" (click)="readWeight(device, kiosk.id)"
                                        class="h-8 px-4 text-xs">
                                        Read Weight
                                    </button>
                                </div>
                            </div>
                        </mat-list-item>
                    </div>
                    <ng-template #noDevices>
                        <div class="p-8 text-center text-gray-400 italic">
                            No devices detected for this kiosk.
                        </div>
                    </ng-template>
                </mat-list>
            </mat-card-content>
        </mat-card>

        <div *ngIf="kiosks.length === 0"
            class="p-8 text-center text-gray-500 bg-gray-50 rounded-xl border border-dashed border-gray-300">
            No Kiosks linked to your account.
        </div>
    </div>
</div>