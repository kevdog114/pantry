<div class="gemini-layout">
  <!-- Sidebar -->
  <aside class="sidebar" *ngIf="showSidebar || !isMobile">
    <button class="new-chat-btn" (click)="newChat()">
      <span class="icon">+</span> New Chat
    </button>
    <div class="session-list">
      <div *ngFor="let session of sessions" class="session-item" [class.active]="session.id === currentSessionId"
        (click)="loadSession(session.id)">
        <span class="session-title">{{ session.title }}</span>
        <button class="delete-btn" (click)="deleteSession(session.id, $event)" title="Delete Chat">ğŸ—‘ï¸</button>
      </div>
    </div>
  </aside>

  <!-- Main Chat -->
  <main class="main-chat" *ngIf="!showSidebar || !isMobile">
    <div *ngIf="isMobile" class="mobile-header">
      <button class="back-btn" (click)="backToSessions()">â† Back</button>
      <span class="mobile-title">Chat</span>
    </div>

    <div class="messages" #scrollContainer>
      <div *ngIf="messages.length === 0" class="welcome-message">
        <h2 class="gradient-text">Hello, Chef</h2>
        <p>How can I help you cook today?</p>
      </div>

      <div *ngFor="let message of messages" class="message">
        <!-- ... existing message content ... -->
        <span class="sender">{{ message.sender }}: </span>

        <div class="message-content-group">
          <div *ngFor="let item of message.contents" class="message-item">
            <!-- Text/Chat Message -->
            <div *ngIf="item.type === 'chat'" class="content">
              <markdown [data]="item.text"></markdown>
            </div>

            <div *ngIf="item.type === 'image'" class="message-image">
              <img [src]="item.imageUrl" alt="Attached Image"
                style="max-width: 200px; border-radius: 8px; margin-bottom: 8px;">
            </div>

            <!-- Recipe Message -->
            <div *ngIf="item.type === 'recipe' && item.recipe" class="recipe-card">
              <div class="recipe-header" (click)="toggleRecipe(item)">
                <h3>ğŸ½ï¸ {{ item.recipe.title }}</h3>
                <div class="header-actions">
                  <button class="save-btn" (click)="$event.stopPropagation(); saveRecipe(item.recipe)"
                    title="Save to Cookbook">ğŸ’¾</button>
                  <span class="toggle-icon">{{ item.expanded ? 'â–²' : 'â–¼' }}</span>
                </div>
              </div>

              <div class="recipe-details" *ngIf="item.expanded">
                <p class="recipe-desc">{{ item.recipe.description }}</p>

                <div class="recipe-time">
                  <span><strong>Prep:</strong> {{ item.recipe.time.prep }}</span>
                  <span><strong>Cook:</strong> {{ item.recipe.time.cook }}</span>
                  <span><strong>Total:</strong> {{ item.recipe.time.total }}</span>
                </div>

                <div class="recipe-section">
                  <h4>Ingredients</h4>
                  <ul>
                    <li *ngFor="let ingredient of item.recipe.ingredients">{{ ingredient }}</li>
                  </ul>
                </div>

                <div class="recipe-section">
                  <h4>Instructions</h4>
                  <ol>
                    <li *ngFor="let step of item.recipe.instructions">{{ step }}</li>
                  </ol>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Loading Indicator -->
      <div *ngIf="isLoading" class="message">
        <span class="sender">Gemini: </span>
        <div class="typing-indicator">
          <span class="dot"></span>
          <span class="dot"></span>
          <span class="dot"></span>
        </div>
      </div>
    </div>

    <div class="input-area" style="flex-direction: column; gap: 8px;">
      <div *ngIf="selectedImage" class="image-preview"
        style="display: flex; align-items: center; gap: 8px; padding: 4px;">
        <img [src]="selectedImagePreview" alt="Preview" style="height: 50px; border-radius: 4px;">
        <button (click)="clearImage()" style="background: none; border: none; cursor: pointer; color: red;">âœ–</button>
      </div>
      <div style="display: flex; width: 100%; gap: 8px; align-items: center;">
        <button class="attach-btn" (click)="fileInput.click()" style="padding: 8px; cursor: pointer;">ğŸ“·</button>
        <input #fileInput type="file" accept="image/*" (change)="onImageSelected($event)" style="display: none">
        <input [(ngModel)]="newMessage" (keyup.enter)="sendMessage()" placeholder="Type a message..." style="flex: 1;">
        <button (click)="sendMessage()">Send</button>
      </div>
    </div>
  </main>
</div>